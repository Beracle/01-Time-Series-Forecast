<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>【数据分析】基于时间序列的预测方法（2020-01-08）</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1><a id="_0"></a>时间序列预测</h1>
<p></p><div class="toc"><h3>目录</h3><ul><li><a href="#_0">时间序列预测</a></li><ul><li><a href="#1_2">1.时间序列介绍</a></li><li><a href="#2_6">2.原始数据集</a></li><li><a href="#3_10">3.导入数据</a></li><li><a href="#4_65">4.检测时间序列的平稳性</a></li><li><a href="#5_118">5.如何使时间序列平稳</a></li><ul><li><a href="#51__129">5.1 估计和消除趋势</a></li><ul><li><a href="#511__130">5.1.1 对数转换</a></li><li><a href="#512__144">5.1.2 移动平均</a></li></ul><li><a href="#52__180">5.2 消除趋势和季节性</a></li><ul><li><a href="#521__184">5.2.1 差异化</a></li><li><a href="#522__197">5.2.2 分解</a></li></ul></ul><li><a href="#6_230">6.预测时间序列</a></li><ul><li><a href="#61_AR_Model_282">6.1 AR Model</a></li><li><a href="#62_MA_Model_291">6.2 MA Model</a></li><li><a href="#63_Combined_Model_300">6.3 Combined Model</a></li><li><a href="#64__310">6.4 恢复到原始比例</a></li></ul></ul></ul></div><p></p>
<h2><a id="1_2"></a>1.时间序列介绍</h2>
<p>时间序列(Time Series，TS)是数据科学中比较有意思的一个领域。顾名思义，TS是按固定时间间隔收集的数据点的集合。对这些数据进行分析以确定长期趋势，以便预测未来或执行其他形式的分析。但是TS又与常规回归问题不同。</p>
<ul>
<li>它是时间相关的。因此，在这种情况下，“观测值是独立的线性回归模型”这个基本假设不成立。</li>
<li>随着趋势的增加或减少，大多数TS具有某种形式的季节性趋势，即特定时间范围内的变化。例如，一件羊毛夹克的销量，随着时间不断向前推进，我们会发现在冬季总是有更高的销量。</li>
</ul>
<h2><a id="2_6"></a>2.原始数据集</h2>
<p>我们以一家超市某种物品的销量作为模拟分析的对象。第一列是字符串格式的日期（从20200101到20200523），第二列是销量情况。<br>
<img src="https://img-blog.csdnimg.cn/20210108123053535.png" alt="在这里插入图片描述"><br>
本文代码基于Jupyter实验环境，可直接复制粘贴运行。</p>
<h2><a id="3_10"></a>3.导入数据</h2>
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
</code></pre>
<p>导入数据，输出前几个数据看一下格式。</p>
<pre><code class="prism language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'Sales.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>dtypes
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109112643171.png" alt="在这里插入图片描述"><br>
将字符串格式的日期转换为标准日期格式。</p>
<pre><code class="prism language-python">dateparse <span class="token operator">=</span> <span class="token keyword">lambda</span> dates<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>dates<span class="token punctuation">,</span> <span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'Sales.csv'</span><span class="token punctuation">,</span> parse_dates<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'日期'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token string">'日期'</span><span class="token punctuation">,</span>date_parser<span class="token operator">=</span>dateparse<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'\n Parsed Data:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>parse_dates：指定包含时间信息的列。如上所述，列名称为“日期”。</li>
<li>index_col：对TS数据使用Pandas的一个关键思想是索引必须是描述时间信息的变量。因此，此参数告诉Pandas使用“日期”列作为索引。</li>
<li>date_parser：指定了一个将输入字符串转换为datetime变量的函数。默认情况下，Pandas读取格式为“ YYYY-MM-DD HH:MM:SS”的数据。如果数据不是这种格式，则必须手动定义格式。因此，可以使用类似于此处定义的dataparse函数的功能。<br>
<img src="https://img-blog.csdnimg.cn/20210108132610956.png" alt="在这里插入图片描述"></li>
</ul>
<p>我们可以看到数据以时间对象为索引。</p>
<pre><code class="prism language-python">data<span class="token punctuation">.</span>index
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108132656968.png" alt="在这里插入图片描述"></p>
<pre><code class="prism language-python">ts <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'销量'</span><span class="token punctuation">]</span>
ts<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/2021010813284670.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
通过索引，我们可以查看具体某天的销量情况。</p>
<pre><code class="prism language-python">ts<span class="token punctuation">[</span><span class="token string">'2020-01-02'</span><span class="token punctuation">]</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108132945636.png" alt="在这里插入图片描述"><br>
查看两个日期之间所有的销量数据。</p>
<pre><code class="prism language-python">ts<span class="token punctuation">[</span><span class="token string">'2020-01-02 '</span><span class="token punctuation">:</span><span class="token string">'2020-01-09 '</span><span class="token punctuation">]</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108133056187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
查看2020-01-08之前（包含1月8号这一天）所有的销量情况。</p>
<pre><code class="prism language-python">ts<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token string">'2020-01-08'</span><span class="token punctuation">]</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108133139823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
查看2020年1月份销量情况。</p>
<pre><code class="prism language-python">ts<span class="token punctuation">[</span><span class="token string">'2020-01'</span><span class="token punctuation">]</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108133240646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2><a id="4_65"></a>4.检测时间序列的平稳性</h2>
<p>如果TS的统计特性（例如均值，方差）随时间保持恒定，则称TS是固定的。大多数TS模型都是在TS固定的前提下工作的。所以在一般情况下，我们可以认为，如果某个TS随时间具有特定的行为，那么将来很有可能会遵循相同的行为。而且，与非平稳序列相比，平稳序列有关的理论更加成熟并且更易于实现。</p>
<p>平稳性有着非常严格的标准定义。但是，出于实际考虑，如果该序列随时间具有不变的统计特性，则可以假定该序列是平稳的。本文提到的平稳性需满足：</p>
<ul>
<li>恒定均值</li>
<li>恒定方差</li>
<li>不依赖时间的自协方差</li>
</ul>
<p>原始销量变化趋势图。</p>
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108133341539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
显然，数据总体上呈上升趋势，并且存在一些季节性变化。但是，这种视觉推断并不总是准确的。因此，我们会使用以下方法检查平稳性：</p>
<ul>
<li>绘制移动统计数据：通过绘制移动平均值或移动方差趋势图，判断其是否随时间变化。</li>
<li>Dickey-Fuller检验：这是用于检查平稳性的统计检验之一。这里的零假设是TS是非平稳的。测试结果包括测试统计量和一些差异置信度的临界值。如果“检验统计量”小于“临界值”，我们可以拒绝原假设并说该序列是平稳的。</li>
</ul>
<p>下面的test_stationarity()函数则包含了上面提到的两种方法。</p>
<pre><code class="prism language-python">!pip install statsmodels
</code></pre>
<pre><code class="prism language-python"><span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>stattools <span class="token keyword">import</span> adfuller
<span class="token keyword">def</span> <span class="token function">test_stationarity</span><span class="token punctuation">(</span>timeseries<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment">#Determing rolling statistics</span>
    rolmean <span class="token operator">=</span> timeseries<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rolstd <span class="token operator">=</span> timeseries<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">#Plot rolling statistics:</span>
    orig <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>timeseries<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'Original'</span><span class="token punctuation">)</span>
    mean <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>rolmean<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Rolling Mean'</span><span class="token punctuation">)</span>
    std <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>rolstd<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Rolling Std'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Rolling Mean &amp; Standard Deviation'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span>block<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    
    <span class="token comment">#Perform Dickey-Fuller test:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Results of Dickey-Fuller Test:'</span><span class="token punctuation">)</span>
    dftest <span class="token operator">=</span> adfuller<span class="token punctuation">(</span>timeseries<span class="token punctuation">,</span> autolag<span class="token operator">=</span><span class="token string">'AIC'</span><span class="token punctuation">)</span>
    dfoutput <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>dftest<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Test Statistic'</span><span class="token punctuation">,</span><span class="token string">'p-value'</span><span class="token punctuation">,</span><span class="token string">'#Lags Used'</span><span class="token punctuation">,</span><span class="token string">'Number of Observations Used'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span>value <span class="token keyword">in</span> dftest<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dfoutput<span class="token punctuation">[</span><span class="token string">'Critical Value (%s)'</span><span class="token operator">%</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token keyword">print</span><span class="token punctuation">(</span>dfoutput<span class="token punctuation">)</span>
</code></pre>
<pre><code class="prism language-python">test_stationarity<span class="token punctuation">(</span>ts<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109115343375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
尽管标准差变化很小，但均值显然随时间增加，这并不是平稳序列。测试统计数据也不仅是含有临界值。注意：应该连同符号比较，而不是绝对值。</p>
<h2><a id="5_118"></a>5.如何使时间序列平稳</h2>
<p>尽管在许多TS模型中都采用了平稳性假设，但实际的时间序列几乎没有一个是平稳的。所幸我们已经找到了一些使时间序列平稳的方法。实际上，要使一个时间序列完全固定几乎是不可能的，但是我们尝试使其尽可能接近平稳。</p>
<p>导致TS不平稳的背后原因主要有两个：</p>
<ol>
<li>趋势——均值随时间变化。例如，乘客数量随时间增长。</li>
<li>季节性——在特定时间范围内的变化。例如，由于加薪或节日的影响，人们可能会在特定月份购买汽车。</li>
</ol>
<p><strong>基本原理</strong>是对时间序列中的趋势和季节性建模或估计，并将其从序列中删除以得到固定的时间序列。然后在该时间序列上实施统计预测技术。最后一步则是通过应用趋势和季节性约束将预测值转换为原始比例。</p>
<p>下面会讨论多种方法。有的可能效果很好，而有的可能效果不好。但是，我们的目的是掌握所有的方法，而不是仅仅关注眼前的问题。</p>
<h3><a id="51__129"></a>5.1 估计和消除趋势</h3>
<h4><a id="511__130"></a>5.1.1 对数转换</h4>
<p>减小趋势的常用技巧是转换。例如，在上文原始数据趋势图中，我们可以清楚地看到存在明显的上升趋势。因此，我们可以应用变换来惩罚较高的值。可以取对数，平方根，立方根等。为简单起见，在这里进行对数转换（注意下图中纵坐标的变化）。</p>
<pre><code class="prism language-python">ts_log <span class="token operator">=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>ts<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108134026104.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
在这种简单的情况下，很容易看到数据中的向前趋势。但是在有噪音的情况下它不是很直观。因此，我们可以先使用一些技术来估算或建模，然后将其从序列中消除。常用的方法有：</p>
<ul>
<li>聚类。在一段时间内取平均值，例如每月/每周平均值。</li>
<li>平滑。取滑动平均值</li>
<li>多项式拟合。拟合回归模型。</li>
</ul>
<p>下面会讨论移动平均技术。</p>
<h4><a id="512__144"></a>5.1.2 移动平均</h4>
<p>在这种方法中，我们根据时间序列的频率取“k”个连续值的平均值。在这里，我们将参数设置为12，即最近12天的数据。</p>
<pre><code class="prism language-python">moving_avg <span class="token operator">=</span> ts_log<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>moving_avg<span class="token punctuation">,</span>color <span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108134121735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
红线表示移动平均值。我们把它从原始时间序列中减去。并且，由于我们取的是最近12个值的平均值，因此前11个值没有定义移动平均值。</p>
<pre><code class="prism language-python">ts_log_moving_avg_diff <span class="token operator">=</span> ts_log <span class="token operator">-</span> moving_avg 
ts_log_moving_avg_diff<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108134201495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
我们先删除这些NaN值，再检查平稳性。</p>
<pre><code class="prism language-python">ts_log_moving_avg_diff<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
test_stationarity<span class="token punctuation">(</span>ts_log_moving_avg_diff<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109120827430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
结果看起来还不错。移动平均值发生了变化，但没有特定趋势。另外，测试统计量小于1％的临界值，因此我们可以以99％的置信度说这是一个平稳的序列。</p>
<p>但是，该方法的缺点是必须严格定义时间段。比如，我们可以采用月平均值，但是在复杂的情况下（例如预测股票价格），很难得出一个数字。因此，我们采用“加权移动平均”，其中，最新值的权重更高。分配权重的技术有多种，流行的是<strong>指数加权移动平均</strong>，其中权重通过衰减因子分配给所有先前的值。</p>
<pre><code class="prism language-python">expwighted_avg <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">.</span>ewm<span class="token punctuation">(</span>ts_log<span class="token punctuation">,</span>halflife <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>expwighted_avg<span class="token punctuation">,</span>color <span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108134343200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
此处的参数“halflife’”用于定义指数衰减量。这只是一个假设，在很大程度上取决于业务领域。其他参数（例如span）也可以用于定义衰减。现在，重复之前的操作，先删除它再检查平稳性.</p>
<pre><code class="prism language-python">ts_log_ewma_diff <span class="token operator">=</span> ts_log <span class="token operator">-</span> expwighted_avg 
test_stationarity<span class="token punctuation">(</span>ts_log_ewma_diff<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109121001809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
测试统计量小于5％的临界值，因此我们可以以95％的置信度说这是一个平稳的序列。在这种情况下，不会遗漏任何值，因为从一开始所有的值都被赋予了权重。因此，即使没有先前的值也可以使用。</p>
<h3><a id="52__180"></a>5.2 消除趋势和季节性</h3>
<p>前面讨论的简单趋势减少技术并不能在所有情况下都有效，尤其是季节性高的情况下。接下来讨论消除趋势和季节性的两种方法：</p>
<ul>
<li>差异化：以特定的时间差来差异化。</li>
<li>分解：对趋势和季节性建模，并将其从模型中删除。</li>
</ul>
<h4><a id="521__184"></a>5.2.1 差异化</h4>
<p>在这项技术中，我们将特定时刻的观测值与前一时刻的观测值进行了差异。这在改善平稳性方面效果很好。此处使用一次偏移进行差异化。</p>
<pre><code class="prism language-python">ts_log_diff <span class="token operator">=</span> ts_log <span class="token operator">-</span> ts_log<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109121237845.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code class="prism language-python">ts_log_diff<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
test_stationarity<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109121323270.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
我们可以看到，均值和标准差随时间变化很小。而且，Dickey-Fuller测试统计量小于5％临界值，因此TS处于95％置信度。我们还可以采用二次或三次偏移，这在某些场景下可能会获得更好的结果。</p>
<h4><a id="522__197"></a>5.2.2 分解</h4>
<p>这种方法对趋势和季节性分别建模，然后返回序列的残余部分。</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>seasonal <span class="token keyword">import</span> seasonal_decompose
decomposition <span class="token operator">=</span> seasonal_decompose<span class="token punctuation">(</span>ts_log<span class="token punctuation">)</span>

trend <span class="token operator">=</span> decomposition<span class="token punctuation">.</span>trend
seasonal <span class="token operator">=</span> decomposition<span class="token punctuation">.</span>seasonal
residual <span class="token operator">=</span> decomposition<span class="token punctuation">.</span>resid

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">411</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Original'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">412</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>trend<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Trend'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">413</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>seasonal<span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'Seasonality'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">414</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>residual<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Residuals'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108134720371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
在这里，我们可以看到趋势，季节性和数据已分离，并且可以对残差进行建模。我们再次检查残差的平稳性：</p>
<pre><code class="prism language-python">ts_log_decompose <span class="token operator">=</span> residual
ts_log_decompose<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_stationarity<span class="token punctuation">(</span>ts_log_decompose<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109121543769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
Dickey-Fuller检验统计量明显低于1％临界值。因此，此TS非常接近固定位置。也可以尝试使用高级分解技术，以产生更好的结果。应该注意的是，在这种情况下，将残差转换为原始数据以用于将来的数据不是很直观。</p>
<h2><a id="6_230"></a>6.预测时间序列</h2>
<p>上面谈到的这些不同的技术都可以使TS趋于平稳。现在让我们在差分后的TS上建立模型。这是一种非常流行的技术，并且在这种情况下，将噪声和季节性重新添加到预测残差中相对较容易。执行了趋势和季节性估计技术后，可能出现两种情况：</p>
<ol>
<li>在数值之间没有相关性的一个严格的平稳序列。这是简单的情况，其中我们可以将残差建模为白噪声，但这是非常罕见的。</li>
<li>数值之间有重大依赖性的时间序列。在这种情况下，我们需要使用ARIMA之类的统计模型来预测数据。</li>
</ol>
<p>ARIMA，即自回归移动平均模型，对平稳时间序列的预测只是一个线性(如线性回归)方程。预测变量取决于ARIMA模型的参数(p，d，q):</p>
<ol>
<li>AR(Auto-Regressive，自回归)项的数量§：AR项是因变量的滞后值。例如，如果p为5，则x(t)的预测变量为x(t-1)…x(t-5)。</li>
<li>MA(Moving Average，移动平均)项的数量(q)： MA项是预测方程式中的滞后预测误差。例如，如果q为5，则x(t)的预测变量将为e(t-1)….e(t-5)，其中e(i)是第i个瞬时移动平均值与实际值之间的差。</li>
<li>差异数(d)：这些是非季节性差异数，即在这种情况下，我们采用一阶差分。因此，我们可以传递该变量并置d = 0，或者传递原始变量并置d = 1。两者都会产生相同的结果。</li>
</ol>
<p>如何确定“ p”和“ q”的值呢？</p>
<ol>
<li>自相关函数(Autocorrelation Function，ACF)：它是TS与自身滞后版本之间的相关性的度量。例如，在滞后值为5，ACF会将时间点“t(1)”…“t(2)”处的序列与时间点“t(1)-5”……“ t(2)-5”处的序列进行比较。</li>
<li>局部自相关函数(Partial Autocorrelation Function，PACF)：此方法在消除了TS与自身滞后版本之间的比较差异后，测量二者的相关性。例如，它将检查滞后值为5的相关性，但删除滞后值为1到4的影响。</li>
</ol>
<p>差分后，绘制TS的ACF和PACF图。</p>
<pre><code class="prism language-python"><span class="token comment">#ACF and PACF plots:</span>
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>stattools <span class="token keyword">import</span> acf<span class="token punctuation">,</span> pacf
</code></pre>
<pre><code class="prism language-python">lag_acf <span class="token operator">=</span> acf<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">,</span> nlags<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
lag_pacf <span class="token operator">=</span> pacf<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">,</span> nlags<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'ols'</span><span class="token punctuation">)</span>
</code></pre>
<pre><code class="prism language-python"><span class="token comment">#Plot ACF: </span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>lag_acf<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.96</span><span class="token operator">/</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">1.96</span><span class="token operator">/</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Autocorrelation Function'</span><span class="token punctuation">)</span>

<span class="token comment">#Plot PACF:</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>lag_pacf<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.96</span><span class="token operator">/</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">1.96</span><span class="token operator">/</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Partial Autocorrelation Function'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210109141550983.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
在上图中，0两侧的两条虚线是置信区间，可用于确定“p”和“q”值，如下所示：</p>
<ul>
<li>p – PACF的滞后值图表首次超过上限置信区间。如果密切注意，在这种情况下，p = 2。</li>
<li>q – ACF图表首次超过上限置信区间的滞后值。如果您密切注意，在这种情况下，q = 2。</li>
</ul>
<p>下面3个不同的ARIMA模型，将分别考虑单独情况和综合情况，并输出RSS。这里的RSS是指残差值，而不是实际的序列。</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>arima_model <span class="token keyword">import</span> ARIMA
</code></pre>
<h3><a id="61_AR_Model_282"></a>6.1 AR Model</h3>
<pre><code class="prism language-python">model <span class="token operator">=</span> ARIMA<span class="token punctuation">(</span>ts_log<span class="token punctuation">,</span> order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
results_AR <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>disp<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>results_AR<span class="token punctuation">.</span>fittedvalues<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'RSS: %.4f'</span><span class="token operator">%</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>results_AR<span class="token punctuation">.</span>fittedvalues<span class="token operator">-</span>ts_log_diff<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135113850.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3><a id="62_MA_Model_291"></a>6.2 MA Model</h3>
<pre><code class="prism language-python">model <span class="token operator">=</span> ARIMA<span class="token punctuation">(</span>ts_log<span class="token punctuation">,</span> order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
results_MA <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>disp<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>results_MA<span class="token punctuation">.</span>fittedvalues<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'RSS: %.4f'</span><span class="token operator">%</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>results_MA<span class="token punctuation">.</span>fittedvalues<span class="token operator">-</span>ts_log_diff<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135202278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3><a id="63_Combined_Model_300"></a>6.3 Combined Model</h3>
<pre><code class="prism language-python">model <span class="token operator">=</span> ARIMA<span class="token punctuation">(</span>ts_log<span class="token punctuation">,</span> order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
results_ARIMA <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>disp<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts_log_diff<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>results_ARIMA<span class="token punctuation">.</span>fittedvalues<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'RSS: %.4f'</span><span class="token operator">%</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>results_ARIMA<span class="token punctuation">.</span>fittedvalues<span class="token operator">-</span>ts_log_diff<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135243437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
我们可以看到AR和MA模型具有几乎相同的RSS，但结合起来明显更好。现在，最后一个步骤，即将这些值恢复为原始比例。</p>
<h3><a id="64__310"></a>6.4 恢复到原始比例</h3>
<p>由于组合模型提供了最佳结果，因此我们将其缩放回原始值并查看其在该位置的性能如何。第一步是将预测结果存储为单独的序列并进行观察。</p>
<pre><code class="prism language-python">predictions_ARIMA_diff <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>results_ARIMA<span class="token punctuation">.</span>fittedvalues<span class="token punctuation">,</span> copy<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
predictions_ARIMA_diff<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135311501.png" alt="在这里插入图片描述"><br>
这些日期从“2020-01-02”开始，而不是“2020-01-01”。因为我们的延迟为1，并且第一个元素之前没有要减去的元素。将差异转换为对数刻度的方法是将这些差异连续添加到基数中。一种简单的方法是先确定索引处的累加和，然后将其加到基数上。累积总和可以找到为：</p>
<pre><code class="prism language-python">predictions_ARIMA_diff_cumsum <span class="token operator">=</span> predictions_ARIMA_diff<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>
predictions_ARIMA_diff_cumsum<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135352533.png" alt="在这里插入图片描述"><br>
接下来，需要将它们添加到基数中。为此，我们创建一个以所有值为基数的序列，并在其中添加差异。在这里，第一个元素是基数本身，并从此开始累加值。</p>
<pre><code class="prism language-python">predictions_ARIMA_log <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>ts_log<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span>ts_log<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
predictions_ARIMA_log <span class="token operator">=</span> predictions_ARIMA_log<span class="token punctuation">.</span>add<span class="token punctuation">(</span>predictions_ARIMA_diff_cumsum<span class="token punctuation">,</span>fill_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
predictions_ARIMA_log<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135431258.png" alt="在这里插入图片描述"><br>
最后一步是利用指数将其还原成原始比例，并与原始序列进行比较。</p>
<pre><code class="prism language-python">predictions_ARIMA <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>predictions_ARIMA_log<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ts<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>predictions_ARIMA<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'RMSE: %.4f'</span><span class="token operator">%</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>predictions_ARIMA <span class="token operator">-</span> ts<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210108135504738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JlX3JhY2xl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
从最终的结果显示，预测的效果还是不错的！</p>
</div>
</body>

</html>
